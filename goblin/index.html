<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Goblin</title>
    <script src="https://code.jquery.com/jquery-3.2.1.js" integrity="sha256-DZAnKJ/6XZ9si04Hgrsxu/8s717jcIzLy3oi35EouyE=" crossorigin="anonymous"></script>
    <script src="items.js">

    </script>
    <script src="helper.js">

    </script>

    <style>
        section {
            float: left;
        }
    </style>

</head>

<body>
    <section>
        <img src="goblin.jpg" class="image" alt="Гоблин">
        <table class="table" bgcolor="lightgreen" border="2" width="391" height="25">
            <tr>
                <td class="hp" id="hp1"></td>
                <td class="hp" id="hp2"></td>
                <td class="hp" id="hp3"></td>
                <td class="hp" id="hp4"></td>
                <td class="hp" id="hp5"></td>
            </tr>
        </table>
        <br>
        <textarea rows="10" cols="53" readonly></textarea>
    </section>

    <section>
        <table border="1" id="inventory">
            <thead>
            </thead>
            <tbody>
                <tr>
                    <td>
                        <img id="t444" src="pictures/Empty_cell.jpg">
                    </td>
                    <td>
                        <img src="pictures/Empty_cell.jpg">
                    </td>
                    <td>
                        <img src="pictures/Empty_cell.jpg">
                    </td>
                    <td>
                        <img src="pictures/Empty_cell.jpg">
                    </td>
                </tr>
                <tr>
                    <td>
                        <img src="pictures/Empty_cell.jpg">
                    </td>
                    <td>
                        <img src="pictures/Empty_cell.jpg">
                    </td>
                    <td>
                        <img src="pictures/Empty_cell.jpg">
                    </td>
                    <td>
                        <img src="pictures/Empty_cell.jpg">
                    </td>
                </tr>
                <tr>
                    <td>
                        <img src="pictures/Empty_cell.jpg">
                    </td>
                    <td>
                        <img src="pictures/Empty_cell.jpg">
                    </td>
                    <td>
                        <img src="pictures/Empty_cell.jpg">
                    </td>
                    <td>
                        <img src="pictures/Empty_cell.jpg">
                    </td>
                </tr>
                <tr>
                    <td>
                        <img src="pictures/Empty_cell.jpg">
                    </td>
                    <td>
                        <img src="pictures/Empty_cell.jpg">
                    </td>
                    <td>
                        <img src="pictures/Empty_cell.jpg">
                    </td>
                    <td>
                        <img src="pictures/Empty_cell.jpg">
                    </td>
                </tr>

            </tbody>
        </table>
    </section>

    <script type="text/javascript" defer>
        var hp = 100;
        var amountItems = 0;

        function writeSystemMessage(message) {
            var txt = $("textarea");
            txt.val(txt.val() + message + "\n");
        }

        function dropGoblin() {
            var result = getRandomNumber(0, 5);
            var outLine = "*Вами был получен предмет [";
            switch (result) {
                case 0:
                    outLine += _items[0].name;
                    break;
                case 1:
                    outLine += _items[1].name;
                    break;
                case 2:
                    outLine += _items[2].name;
                    break;
                case 3:
                    outLine += _items[3].name;
                    break;
                case 4:
                    outLine += _items[4].name;
                    break;
                default:
                    break;
            }
            outLine += '].*';
            writeSystemMessage(outLine);
            addItemToInventory(_items[result]);
        }

        function addItemToInventory(item) {
            if (amountItems === 16) {
                $('#inventory > tbody > tr > td > img').attr("src","pictures/Empty_cell.jpg");
                amountItems = 0;
            }
            $('#inventory > tbody > tr:eq('+ Math.floor(amountItems / 4) +') > td:eq('+ (amountItems % 4) +') > img').attr("src","pictures//" + item.imageUrl);
            // todo: add text to <td> that contais img
            amountItems++;
        }

        function makeGoblinAlive() {
            $('.hp').css('background', 'lightgreen');
            hp = 100;
        }

        $(".image").click(function () {
            hp -= 20;

            $('.hp').css('background', 'lightgreen');

            for (var i = 81, j = 5; j > 1; i -= 20, j--) {
                if (hp < i) {
                    $('#hp' + j).css('background', 'red');
                }
            }

            if (hp < 1) {
                $('#hp1').css('background', 'red').promise().done(function () {
                    setTimeout(function () {
                        writeSystemMessage("*Вами был убит противник [Гоблин].*");
                        dropGoblin();
                        setTimeout(function () {
                            var result = confirm('Гоблин мёртв. Воскресить?');
                            if (result === true) {
                                makeGoblinAlive();
                            }
                        }, 100);
                    }, 100);
                });
            }
        });
    </script>
</body>

</html>